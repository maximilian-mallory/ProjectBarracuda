<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Long Name Game</title>
    <link rel="stylesheet" href="../static/css/GamePage.css">
    <script>

        var numGuesses = 0;
        var remainingTime = 0;

        function checkGuess() 
        {
          numGuesses++;

          let currentLocation = "{{city_name}}";
  
          var guess = window.prompt("{{city_name}}");
          
          console.log(currentLocation);
  
          if( guess.toLowerCase() == currentLocation )
          {
            clearInterval(interval);
            
            var data = {
            timeLeft: remainingTime.toString(),
            numGuesses: numGuesses.toString()
            };

            fetch('/save_score/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Error saving guess');
                }
                return response.text();
            })
            .then(data => {
                console.log(JSON.stringify(data));
                alert("Correct");
            })
            .catch(error => {
                console.error('Error saving guess:', error);
                alert("Error saving guess");
            });
          }
          else
          {
            alert("Wrong");
          }
          
          console.log(numGuesses);
        }
  
        function initialize ()
        {
          var latitude = parseFloat("{{lat_con}}");
          var longitude = parseFloat("{{long_con}}");
          const fenway = { lat: latitude, lng: longitude };
         
          const panorama = new google.maps.StreetViewPanorama(
            document.getElementById("pano"),
            {
              position: fenway,
              pov: {
                heading: 34,
                pitch: 10,
              },
              
              linksControl: true,
              panControl: false,
              enableCloseButton: false,
              addressControl: false,
              showRoadLabels: false,
            },           
          );

          map.setStreetView(panorama);
          console.log("Link Control is " + panorama.linksControl);
        }
  
       

        window.initialize = initialize;
      </script>
</head>
<body>

<div id="container">
    <div id="title" class="main-title">
        <h1>The Legend of Culture: Barracuda Quest the Game 2 Electric Boogaloo Definitive Edition Remastered 2</h1>
    </div>
</div>

<div id="container">
    <div class="side-box">
        <h2>Hints</h2>
        <ul>
            <li>Hint</li>
            <li>Hint</li>
            <li>Hint</li>
            <li>Hint</li>
            <li>Hint</li>
            <li>Hint</li>
            <li>Hint</li>
            <li>Hint</li>
        </ul>
    </div>
    <div id="pano"></div>
    <div class="side-box">
      <table class="scoreboard">
        <thead>
          <tr>
            <th>Position</th>
            <th>Score</th>
          </tr>
        </thead>
        <tbody id="scoreboardBody">
          <!-- Table body will be populated dynamically -->
        </tbody>
      </table>
        </div>
</div>
<div class="button-group">
  <img src="../static/images/Cloud.png">
  <button class="btn" onclick="initialize()">New Game (Reload Map)</button>
</div>
        <!-- I will be adding AJAX funcitonality to the above button to load a new game asynchronously-->
        
          <input
            class="button"
            type="button" 
            value="{{city_name}}"
            onclick="checkGuess();"
          />
       
        <!-- this is the button for guessing. I can look into getting a better popup window, or we can have a permanent textbox within the game page-->
    

<div id="container">
    <div id="timerDiv" class="side-box bottom">
    </div>
    <div class="main-content bottom-content">
        <h2>Quotes to keep you going!</h2>
        <p>"You don't suck!</p>
        <p>"You're parents divorce wasn't your fault!</p>
    </div>
    <div class="side-box bottom">
      <img class= "logo" src="../static/images/Project-Barracuda_Logo.jpg">
    </div>
</div>
<script
      src="https://maps.googleapis.com/maps/api/js?key={{ key }}&callback=initialize&v=weekly"
      async
    >
</script>
<script>

  var interval;

  function startTimer(duration, display) {
            var timer = duration, minutes, seconds;
            var interval = setInterval(function () {

                //figures out how many minutes and seconds there are based on the duration variable
                minutes = parseInt(timer / 60, 10);
                seconds = parseInt(timer % 60, 10);
                
                // adds padding
                //minutes = minutes < 10 ? "0" + minutes : minutes;
                seconds = seconds < 10 ? "0" + seconds : seconds;

                //display content
                display.textContent = minutes + ":" + seconds;

                if (--timer < 0) {
                    clearInterval(interval);
                    display.textContent = "Time's up!";
                } else if (timer < 180 && timer >= 60) {
                    display.style.color = "yellow";
                } else if (timer < 60 && timer >= 30) {
                    display.style.color = "red";
                } else if (timer < 30 && timer % 2 == 1) {
                    display.style.color = "red";
                    display.style.backgroundColor = "black";
                } else if (timer < 30 && timer % 2 == 0) {
                    display.style.color = "red";
                    display.style.backgroundColor = "white";
                }
            }, 1000);

            remainingTime = timer;
        }

        window.onload = function () {
            var fiveMinutes = 300,
                display = document.querySelector('#timerDiv');
            interval = startTimer(fiveMinutes, display);
        };
        const scores = [100, 90, 80, 70, 60, 50, 40, 30, 20, 10];

  // Function to populate the scoreboard
  function populateScoreboard() {
    const tbody = document.getElementById('scoreboardBody');
    tbody.innerHTML = ''; // Clear previous entries
    scores.forEach((score, index) => {
      const row = document.createElement('tr');
      const positionCell = document.createElement('td');
      positionCell.textContent = index + 1;
      const scoreCell = document.createElement('td');
      scoreCell.textContent = score;
      row.appendChild(positionCell);
      row.appendChild(scoreCell);
      tbody.appendChild(row);
    });
  }

  // Call the function to initially populate the scoreboard
  populateScoreboard();
</script>
</body>

</html>
